# T1.4: Equipment Relationships - Field Requirements

## ‚úÖ Schema Approved - Field Optionality

The table design allows capturing all data when available, but doesn't enforce it when not provided.

---

## üìã Required Fields (NOT NULL)

These fields **must** be provided when creating a relationship:

```sql
equipment_id VARCHAR(32) NOT NULL          -- Which equipment
relationship_type VARCHAR(50) NOT NULL     -- What type of relationship
entity_name VARCHAR(500) NOT NULL          -- Name of related entity
effective_from TIMESTAMPTZ NOT NULL        -- When relationship started
relationship_status VARCHAR(50) NOT NULL   -- Current status
created_at TIMESTAMPTZ NOT NULL            -- Audit timestamp
```

**Minimum Example:**
```sql
INSERT INTO equipment_relationships (
    equipment_id, 
    relationship_type, 
    entity_name, 
    effective_from
) VALUES (
    'EQ-12345',
    'owner',
    'City Hospital',
    NOW()
);
-- All other fields default to NULL or default values
```

---

## üîì Optional Fields (Nullable)

These fields can be provided when available:

### **Organization & Facility Links**
```sql
related_org_id UUID           -- NULL if not linked to org
related_facility_id UUID      -- NULL if not linked to facility
entity_type VARCHAR(50)       -- NULL if type unknown
```

### **Location Details (Optional)**
```sql
location_details JSONB        -- NULL if no internal location
address JSONB                 -- NULL if address not captured
gps_latitude DECIMAL(10,8)    -- NULL if GPS not available
gps_longitude DECIMAL(11,8)   -- NULL if GPS not available
```

**Use Cases:**
- ‚úÖ Have GPS? Store it: `19.0760, 72.8777`
- ‚ùå No GPS? Leave NULL
- ‚úÖ Know building/floor? Store in `location_details`
- ‚ùå Only have name? Just store `entity_name`, rest NULL

### **Transfer/Change Information (Optional)**
```sql
reason VARCHAR(255)           -- NULL if no reason recorded
transfer_type VARCHAR(50)     -- NULL if not a transfer
transfer_documents JSONB      -- NULL if no documents
```

### **Financial Details (Optional)**
```sql
transaction_amount DECIMAL(15,2)    -- NULL if no financial transaction
transaction_currency VARCHAR(3)     -- Defaults to 'INR'
payment_terms JSONB                 -- NULL if no payment terms
contract_reference VARCHAR(100)     -- NULL if no contract
```

**Use Cases:**
- ‚úÖ Lease with payment terms? Store them
- ‚ùå Simple installation? Leave NULL
- ‚úÖ Purchase with amount? Store it
- ‚ùå Just ownership record? Amount = NULL

### **Termination Details (Optional)**
```sql
effective_to TIMESTAMPTZ      -- NULL = currently active
terminated_at TIMESTAMPTZ     -- NULL = not terminated
terminated_by VARCHAR(255)    -- NULL = not terminated
termination_reason TEXT       -- NULL = not terminated
```

### **Audit Trail (Optional)**
```sql
notes TEXT                    -- NULL if no notes
created_by VARCHAR(255)       -- NULL if system created
```

---

## üéØ Practical Examples

### **Example 1: Minimal Equipment Registration**
```sql
-- Just record ownership with minimal info
INSERT INTO equipment_relationships (
    equipment_id, relationship_type, entity_name, effective_from
) VALUES (
    'EQ-MRI-001', 'owner', 'Apollo Hospital', NOW()
);

-- Everything else NULL
-- ‚úÖ Valid and sufficient for basic tracking
```

### **Example 2: Complete Equipment Lease**
```sql
-- Hospital leases equipment with full details
INSERT INTO equipment_relationships (
    equipment_id, relationship_type, related_org_id, entity_name,
    location_details, address, gps_latitude, gps_longitude,
    effective_from, transaction_amount, payment_terms,
    contract_reference, created_by
) VALUES (
    'EQ-CT-001', 
    'owner', 
    'leasing-company-uuid',
    'MedLease India Pvt Ltd',
    '{"building": "Radiology", "floor": "2", "room": "RAD-201"}',
    '{"street": "MG Road", "city": "Mumbai", "state": "Maharashtra"}',
    19.0760,
    72.8777,
    '2024-11-16 10:00:00+05:30',
    2500000.00,
    '{"type": "lease", "duration_months": 36, "monthly_amount": 75000}',
    'LEASE-2024-1234',
    'admin@hospital.com'
);

-- Full details when available
-- ‚úÖ Captures everything for comprehensive tracking
```

### **Example 3: Equipment Transfer (Partial Data)**
```sql
-- Transfer equipment, no GPS but have location
INSERT INTO equipment_relationships (
    equipment_id, relationship_type, entity_name,
    location_details, effective_from, reason,
    transfer_type, created_by
) VALUES (
    'EQ-VENT-045',
    'owner',
    'District Hospital',
    '{"department": "ICU", "ward": "ICU-A"}',
    '2024-11-16 14:30:00+05:30',
    'Equipment donated',
    'transfer',
    'procurement@hospital.com'
);

-- No GPS, no financial details, no address
-- ‚úÖ Still valid, captures what's available
```

### **Example 4: Service Provider Assignment**
```sql
-- Assign service provider with contract
INSERT INTO equipment_relationships (
    equipment_id, relationship_type, entity_name,
    effective_from, contract_reference, created_by
) VALUES (
    'EQ-XRAY-023',
    'service_provider',
    'MedTech Services',
    '2024-11-16 09:00:00+05:30',
    'AMC-2024-XRAY-023',
    'maintenance@hospital.com'
);

-- No location, no amount, no payment terms
-- ‚úÖ Just tracks service provider assignment
```

### **Example 5: Location Change Only**
```sql
-- Equipment moved to different department
INSERT INTO equipment_relationships (
    equipment_id, relationship_type, entity_name,
    location_details, gps_latitude, gps_longitude,
    effective_from, reason, created_by
) VALUES (
    'EQ-DEFIB-012',
    'facility',
    'Main Hospital - Emergency Department',
    '{"building": "Main", "floor": "Ground", "department": "Emergency"}',
    19.0755,
    72.8780,
    '2024-11-16 11:00:00+05:30',
    'Equipment relocated from ICU to ER',
    'admin@hospital.com'
);

-- No owner info, just location tracking
-- ‚úÖ Records facility relationship independently
```

---

## üîç Field Usage Guidelines

### **When to Use GPS Coordinates:**
- ‚úÖ Fixed installations (MRI, CT Scanner)
- ‚úÖ High-value equipment tracking
- ‚úÖ Multi-building hospital campuses
- ‚ùå Mobile equipment (not practical)
- ‚ùå Small devices frequently moved

### **When to Use Payment Terms:**
- ‚úÖ Leasing agreements
- ‚úÖ Installment purchases
- ‚úÖ Rental equipment
- ‚ùå Outright cash purchases (use transaction_amount only)
- ‚ùå Donated equipment

### **When to Use Location Details:**
- ‚úÖ Internal facility tracking (building/floor/room)
- ‚úÖ Department assignment
- ‚úÖ Ward-level tracking
- ‚ùå If only organization-level relationship matters

### **When to Use Transfer Documents:**
- ‚úÖ Equipment sales (invoice, receipt)
- ‚úÖ Ownership transfers (legal documents)
- ‚úÖ Lease agreements
- ‚ùå Simple internal moves

---

## üìä Data Capture Strategy

### **Phase 1: Basic Implementation**
Start with minimal required fields:
- `equipment_id`
- `relationship_type`
- `entity_name`
- `effective_from`

### **Phase 2: Add Organization Links**
When org management in place:
- `related_org_id`
- `entity_type`

### **Phase 3: Enhanced Location**
When location tracking needed:
- `location_details`
- `address`

### **Phase 4: GPS Integration**
When IoT/tracking systems ready:
- `gps_latitude`
- `gps_longitude`

### **Phase 5: Financial Integration**
When finance module ready:
- `transaction_amount`
- `payment_terms`
- `contract_reference`

---

## ‚úÖ Benefits of Optional Design

1. **Start Simple** - Begin with minimal data, add more later
2. **No Migration Pain** - Schema supports future data without changes
3. **Flexible Capture** - Store what you have, skip what you don't
4. **Future-Proof** - Ready for GPS, payments, etc. when needed
5. **No Blocking** - Don't wait for complete data to start tracking

---

## üöÄ Implementation Recommendation

**Start with minimal required fields** for initial rollout:
```sql
-- Simple ownership tracking
INSERT INTO equipment_relationships 
    (equipment_id, relationship_type, entity_name, effective_from)
VALUES 
    ('EQ-001', 'owner', 'Hospital A', NOW());
```

**Gradually enhance** as systems mature:
```sql
-- Add location when available
UPDATE equipment_relationships 
SET location_details = '{"building": "Main", "floor": "2"}'
WHERE equipment_id = 'EQ-001';

-- Add GPS when IoT deployed
UPDATE equipment_relationships 
SET gps_latitude = 19.0760, gps_longitude = 72.8777
WHERE equipment_id = 'EQ-001';
```

---

**Status:** ‚úÖ Schema Approved - All fields optional except core requirements

This design allows you to **start simple and grow complex** as your needs evolve! üöÄ
